<!-- archivo: app/superadmin/templates/superadmin/usuarios/listar_usuarios.html -->
{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h2>Usuarios {{'del Bufete ' ~ bufete_id if bufete_id else '(Global)'}} </h2>
    <a href="{{ url_for('superadmin_bp.crear_usuario') }}"
       class="btn btn-primary"
       title="Registrar un nuevo usuario">+ Nuevo Usuario</a>
  </div>

  <form class="mt-3 mb-3" method="get">
    <div class="input-group">
      <input type="text" class="form-control" name="q" placeholder="Buscar por nombre/correo..." value="{{ q or '' }}" title="Escribe nombre o correo">
      <button class="btn btn-outline-secondary" type="submit" title="Filtrar listado">Buscar</button>
    </div>
  </form>

  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Rol</th>
        <th>Bufete</th>
        <th>Activo</th>
        <th class="text-end">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for u in usuarios %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ (u.nombres or '') ~ ' ' ~ (u.apellidos or '') }}</td>
        <td>{{ u.correo or '-' }}</td>
        <td>{{ u.rol.name if u.rol and u.rol.name is defined else (u.rol or '-') }}</td>
        <td>{{ u.bufete.nombre_bufete if u.bufete is defined and u.bufete else '-' }}</td>
        <td>
          {% if u.activo %}
          <span class="badge bg-success">SÃ­</span>
          {% else %}
          <span class="badge bg-secondary">No</span>
          {% endif %}
        </td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-primary"
             href="{{ url_for('superadmin_bp.editar_usuario', usuario_id=u.id) }}"
             title="Editar datos del usuario">Editar</a>
          <form action="{{ url_for('superadmin_bp.toggle_usuario', usuario_id=u.id) }}"
                method="post" style="display:inline-block">
            <button class="btn btn-sm btn-outline-warning" type="submit"
                    title="{{ 'Desactivar' if u.activo else 'Activar' }} usuario">
              {{ 'Desactivar' if u.activo else 'Activar' }}
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
