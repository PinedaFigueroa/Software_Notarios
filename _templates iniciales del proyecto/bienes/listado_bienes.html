{% extends "base.html" %}

{% block content %}
    <h1 class="mb-4">{{ title }}</h1>

    <div class="row mb-3">
        <div class="col-md-6">
            <a href="{{ url_for('bienes_bp.agregar_inmueble') }}" class="btn btn-success me-2">
                <i class="bi bi-house-add-fill me-2"></i>Agregar Inmueble
            </a>
            <a href="{{ url_for('bienes_bp.agregar_mueble') }}" class="btn btn-info">
                <i class="bi bi-car-fill me-2"></i>Agregar Mueble
            </a>
        </div>
    </div>

    {# Corregidos data-bs-toggle/target a data-toggle/target para Bootstrap 4 #}
    <ul class="nav nav-tabs" id="bienesTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="bienes-inmuebles-tab" data-toggle="tab" data-target="#bienes-inmuebles" type="button" role="tab" aria-controls="bienes-inmuebles" aria-selected="true">Bienes Inmuebles</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="bienes-muebles-tab" data-toggle="tab" data-target="#bienes-muebles" type="button" role="tab" aria-controls="bienes-muebles" aria-selected="false">Bienes Muebles</button>
        </li>
    </ul>

    <div class="tab-content" id="bienesTabsContent">
        <div class="tab-pane fade show active" id="bienes-inmuebles" role="tabpanel" aria-labelledby="bienes-inmuebles-tab">
            <div class="card shadow-sm mt-3 mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Listado de Bienes Inmuebles</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% set inmuebles = bienes | selectattr('tipo_bien', 'equalto', 'Inmueble') | list %}
                        {% if inmuebles %}
                        <table class="table table-hover table-striped table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Descripción Corta</th>
                                    <th>Valor Estimado</th>
                                    <th>Finca</th>
                                    <th>Folio</th>
                                    <th>Libro</th>
                                    <th>Ubicación</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for bien in inmuebles %}
                                <tr>
                                    <td>{{ bien.descripcion_corta }}</td>
                                    <td>Q. {{ bien.valor_estimado | format_currency }}</td>
                                    <td>{{ bien.finca if bien.finca else 'N/A' }}</td>
                                    <td>{{ bien.folio if bien.folio else 'N/A' }}</td>
                                    <td>{{ bien.libro if bien.libro else 'N/A' }}</td>
                                    <td>{{ bien.ubicacion_direccion if bien.ubicacion_direccion else 'N/A' }}</td>
                                    <td>
                                        <a href="{{ url_for('bienes_bp.editar_inmueble', bien_id=bien.id) }}" class="btn btn-outline-warning btn-sm me-1" title="Editar"><i class="bi bi-pencil"></i></a>
                                        <form action="{{ url_for('bienes_bp.eliminar_bien', bien_id=bien.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('¿Estás seguro de eliminar este Bien Inmueble? Esta acción no se puede deshacer.');">
                                            <button type="submit" class="btn btn-outline-danger btn-sm" title="Eliminar"><i class="bi bi-trash"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <p class="text-muted">No hay bienes inmuebles registrados para este bufete.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="bienes-muebles" role="tabpanel" aria-labelledby="bienes-muebles-tab">
            <div class="card shadow-sm mt-3 mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Listado de Bienes Muebles</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% set muebles = bienes | selectattr('tipo_bien', 'equalto', 'Mueble') | list %}
                        {% if muebles %}
                        <table class="table table-hover table-striped table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Descripción Corta</th>
                                    <th>Valor Estimado</th>
                                    <th>Marca</th>
                                    <th>Modelo</th>
                                    <th>Placa</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for bien in muebles %}
                                <tr>
                                    <td>{{ bien.descripcion_corta }}</td>
                                    <td>Q. {{ bien.valor_estimado | format_currency }}</td>
                                    <td>{{ bien.marca if bien.marca else 'N/A' }}</td>
                                    <td>{{ bien.modelo if bien.modelo else 'N/A' }}</td>
                                    <td>{{ bien.numero_placa if bien.numero_placa else 'N/A' }}</td>
                                    <td>
                                        <a href="{{ url_for('bienes_bp.editar_mueble', bien_id=bien.id) }}" class="btn btn-outline-warning btn-sm me-1" title="Editar"><i class="bi bi-pencil"></i></a>
                                        <form action="{{ url_for('bienes_bp.eliminar_bien', bien_id=bien.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('¿Estás seguro de eliminar este Bien Mueble? Esta acción no se puede deshacer.');">
                                            <button type="submit" class="btn btn-outline-danger btn-sm" title="Eliminar"><i class="bi bi-trash"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <p class="text-muted">No hay bienes muebles registrados para este bufete.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}